/* 
	Who	When	What
    	==========================================================================================
	KB	MMDDYY	Initial view created
	JZ	122022	Updated format of code and added header
	CM	122122	added AGR_BUS_UNIT for ISG pricing
	CM 	011823	added AGR_INT_COMMENTS
	KB  	013123  Combined Oracle and Siebel data tables with conditions
	CM	020123	added AGR_LINE_COMMENTS
*/
-- Need to check view for Cartesian join causing duplication
-- Comment out Create line when testing to not blow away your working view
--CREATE or replace VIEW SIEBEL_QUOTE_ASSET AS
SELECT
T1.AGREE_ID,
T1.AGR_NUM,
T1.AGR_NAME,
T1.AGR_OPP_ID,
T1.AGREE_STATUS,
T1.ora_ord_num,
T1.BILL_TO_ADDR_SITE,
T1.SHIP_TO_ADDR_SITE,
T1.CURRENCY,
T1.AGR_BILL_TYPE,
T1.AGR_BILL_FREQ,
T1.AGR_ACCT_AUTH,
T1.AGREE_TYPE,
T1.AGREE_SALES_REP_CD,
T1.AGR_LINE_ID,
T1.AGR_LINE_STATUS,
T1.ASSET_NUM,
T1.ASSET_SF_ID,
T1.QTY_REQ,
T1.AGR_LINE_START_DT,
T1.AGR_LINE_END_DT,
T1.MONTH_PRICE,
T1.ADJ_UNIT_PRI,
T1.LINE_SPN,
T1.INT_MODEL,
T1.AGR_CAL_INT_MO,
T1.PRICE_OVRD_FLG,
T1.AGR_BUS_UNIT,
T1.AGR_INT_COMMENTS,
T1.AGR_LINE_COMMENTS,
T2.AGREE_ID AS Oracle_AGREE_ID, 
T2.AGR_NUM AS Oracle_AGR_NUM,
T2.ORA_AGR_ID AS Oracle_ORA_AGR_ID ,
T2.AGR_LINE_ID AS Oracle_AGR_LINE_ID ,
T2.AGR_REVISION AS Oracle_AGR_REVISION ,
T2.ORDER_STATUS AS Oracle_ORDER_STATUS ,
T2.ORACLE_LINE_ID AS Oracle_LINE_ID,
T2.LINE_NUMBER AS Oracle_LINE_NUMBER ,
T2.SPN AS Oracle_SPN ,
T2.ITEM_SERVICED AS Oracle_ITEM_SERVICED,
T2.DURATION_MONTHS AS Oracle_DURATION_MONTHS ,
T2.BILL_DAY_OF_THE_MONTH AS Oracle_BILL_DAY_OF_THE_MONTH ,
T2.NEXT_BILLING_DATE AS Oracle_NEXT_BILLING_DATE ,
T2.DURATION AS Oracle_DURATION ,
T2.BILLING_FREQUENCY AS Oracle_BILLING_FREQUENCY,
T2.COMMENTS AS Oracle_COMMENTS ,
T2.INVOICE_AMT AS Oracle_INVOICE_AMT
FROM 
INTFUSER.TMP_AGR_DATA_PRD_ACT T1
LEFT JOIN
INTFUSER.XXKT_SIEBEL_ELIG_ORD_MIG T2
ON T1.AGR_LINE_ID = T2.AGR_LINE_ID 
AND T2.LINE_NUMBER IS NOT NULL
AND T2.DURATION != 0
AND (T2.BILLING_FREQUENCY IS NOT NULL OR T2.BILLING_FREQUENCY NOT LIKE 'N/A');